<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBE Unified Financial Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root { --cbe-blue: #003366; --cbe-gold: #c5a059; --slate: #1e293b; --bg: #f8fafc; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; color: var(--slate); }
        
        /* Layout */
        .header { background: var(--cbe-blue); color: white; padding: 20px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .nav-container { display: flex; justify-content: center; gap: 15px; padding: 20px; background: white; border-bottom: 1px solid #e2e8f0; position: sticky; top: 0; z-index: 100; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; max-width: 1600px; margin: auto; }
        
        /* Buttons */
        .btn { padding: 12px 24px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 8px; }
        .btn-blue { background: var(--cbe-blue); color: white; }
        .btn-gold { background: var(--cbe-gold); color: white; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* PDF Viewer Section */
        .pdf-viewer-container { background: #525659; border-radius: 12px; height: 80vh; overflow: hidden; border: 1px solid #ddd; position: sticky; top: 100px; }
        iframe { width: 100%; height: 100%; border: none; }

        /* Table Styling */
        .data-section { height: 80vh; overflow-y: auto; padding-right: 10px; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .card-header { padding: 15px; border-bottom: 1px solid #f1f5f9; font-weight: bold; color: var(--cbe-blue); background: #f8fafc; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; background: #f1f5f9; color: #64748b; font-size: 11px; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .val { font-family: 'JetBrains Mono', monospace; text-align: right; font-weight: bold; color: #0f172a; }
        
        @media (max-width: 1000px) { .main-grid { grid-template-columns: 1fr; } .pdf-viewer-container { height: 400px; } }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0; font-size: 24px;">Central Bank of Egypt Statistics Portal</h1>
</div>

<div class="nav-container">
    <button class="btn btn-blue" onclick="scrollToData()">ðŸ“Š View Extracted Tables</button>
    <button class="btn btn-gold" onclick="toggleFX()">ðŸ’° Live FX Rates (EGP)</button>
    <a href="yoo.pdf" target="_blank" class="btn" style="background:#64748b; color:white; text-decoration:none;">ðŸ“‚ Pop-out PDF</a>
</div>

<div class="main-grid">
    <div class="data-section" id="data-area">
        
        <div id="fx-card" class="card" style="display:none; border-left: 5px solid var(--cbe-gold);">
            <div class="card-header">Live EGP Exchange Rates (Interbank)</div>
            <table>
                <thead>
                    <tr><th>Currency</th><th>Pair</th><th>Buy</th><th>Sell</th></tr>
                </thead>
                <tbody id="fx-body">
                    </tbody>
            </table>
        </div>

        <div id="status" style="padding:10px; font-size:12px; color:#94a3b8;">Scanning yoo.pdf...</div>
        <div id="output"></div>
    </div>

    <div class="pdf-viewer-container">
        <iframe src="yoo.pdf#toolbar=0" title="PDF Document"></iframe>
    </div>
</div>

<script>
    const PDF_PATH = 'yoo.pdf';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    function toggleFX() {
        const card = document.getElementById('fx-card');
        card.style.display = card.style.display === 'none' ? 'block' : 'none';
        if(card.style.display === 'block') fetchRates();
    }

    async function fetchRates() {
        const currencies = { 
            'USD': 'ðŸ‡ºðŸ‡¸ US Dollar', 'EUR': 'ðŸ‡ªðŸ‡º Euro', 'JPY': 'ðŸ‡¯ðŸ‡µ Japanese Yen', 
            'GBP': 'ðŸ‡¬ðŸ‡§ British Pound', 'CHF': 'ðŸ‡¨ðŸ‡­ Swiss Franc', 
            'SAR': 'ðŸ‡¸ðŸ‡¦ Saudi Riyal', 'AED': 'ðŸ‡¦ðŸ‡ª UAE Dirham' 
        };
        try {
            const res = await fetch('https://open.er-api.com/v6/latest/USD');
            const data = await res.json();
            const egp = data.rates.EGP;
            let html = '';
            
            for (let [code, name] of Object.entries(currencies)) {
                const rate = (egp / data.rates[code]).toFixed(4);
                html += `<tr>
                    <td>${name}</td>
                    <td>${code}/EGP</td>
                    <td class="val">${(rate * 0.998).toFixed(4)}</td>
                    <td class="val">${(rate * 1.002).toFixed(4)}</td>
                </tr>`;
            }
            document.getElementById('fx-body').innerHTML = html;
        } catch (e) { document.getElementById('fx-body').innerHTML = 'Error loading rates.'; }
    }

    async function init() {
        const output = document.getElementById('output');
        try {
            const pdf = await pdfjsLib.getDocument(PDF_PATH).promise;
            document.getElementById('status').innerText = "Displaying extracted annex data:";
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const text = await page.getTextContent();
                const rows = {};
                text.items.forEach(item => {
                    const y = Math.round(item.transform[5]);
                    if (!rows[y]) rows[y] = [];
                    rows[y].push({ x: item.transform[4], str: item.str.trim() });
                });

                let tableRows = "";
                Object.keys(rows).sort((a,b) => b-a).forEach(y => {
                    const line = rows[y].sort((a,b) => a.x - b.x);
                    const lineStr = line.map(it => it.str).join(" ");
                    const nums = line.filter(it => /^-?[\d,.]+(\(.*\))?$/.test(it.str) && it.str.length > 1);

                    if (nums.length >= 2 && /[A-Za-z]/.test(lineStr)) {
                        tableRows += `<tr>
                            <td style="font-weight:600; width:60%">${lineStr.replace(/[0-9,.( )]{2,}/g, '').trim()}</td>
                            <td class="val">${nums[0].str}</td>
                            <td class="val">${nums[nums.length-1].str}</td>
                        </tr>`;
                    }
                });

                if (tableRows) {
                    output.innerHTML += `<div class="card">
                        <div class="card-header">Statistical Annex - Page ${i}</div>
                        <table><thead><tr><th>Description</th><th>Previous</th><th>Current</th></tr></thead>
                        <tbody>${tableRows}</tbody></table></div>`;
                }
            }
        } catch (e) { document.getElementById('status').innerText = "File yoo.pdf not found."; }
    }
    window.onload = init;
</script>
</body>
</html>
